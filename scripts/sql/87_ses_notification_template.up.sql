---- update notification template for CI trigger ses/smtp
UPDATE notification_templates
set template_payload = '{"from": "{{fromEmail}}",
 "to": "{{toEmail}}",
 "subject": "CI triggered for app: {{appName}}",
 "html": "<div style=/"background-color:#f2f4f7/"><div class=/"notification-wrapper/" style=/"max-height:100%;overflow:scroll;border:1px solid #f2f4f7;max-width:600px;min-width:400px;margin:auto;color:#000a14;font-family:Open Sans;font-size:14px;background-color:#fff/"><div style=/"padding:20px;border-bottom:1px solid #f2f4f7/"><img style=/"max-width:122px/" src=/"https://devtron-public-asset.s3.us-east-2.amazonaws.com/images/devtron/devtron-logo.png/" alt=/"ci-triggered/"></div><div style=/"margin:20px;background-color:#e5f2ff;border-radius:8px/"><table width=/"100%/" cellpadding=/"0/" cellspacing=/"0/"><tr><td style=/"font-size:16px;font-weight:600;border:0;padding:20px 20px 0 20px/">▶️<span style=/"padding-left:10px/">{{stage}} triggered</span></td></tr><tr><td style=/"padding-top:4px;line-height:1.43;border:0;padding:0 20px/">{{eventTime}}</td></tr><tr><td style=/"padding-bottom:20px;line-height:1.43;border:0;padding:0 20px 20px 20px/">by<span style=/"color:#06c/">{{triggeredBy}}</span></td></tr><tr><td><div style=/"padding:10px 12px;font-size:12px;border-radius:4px;background:#06c;cursor:pointer;font-weight:600;max-width:fit-content;margin:0 20px 20px 20px/"><a href=/"{{& buildHistoryLink }}/" target=/"_blank/" style=/"color:#fff;text-decoration:none/">View Pipeline</a></div></td></tr></table></div><div style=/"border-bottom:1px solid #f2f4f7;padding:0 20px 20px 20px/"><table width=/"100%/"><tbody style=/"border-bottom:1px solid #edf1f5/"><tr><td style=/"font-size:12px;color:#3b444c;font-weight:600;width:50%/">Application</td><td style=/"font-size:12px;color:#3b444c;font-weight:600;width:50%/">Pipeline</td></tr><tr><td style=/"width:50%/">{{appName}}</td><td style=/"width:50%/">{{pipelineName}}</td></tr></tbody></table></div><div style=/"padding:20px/"><div style=/"font-weight:700;padding-bottom:10px/">Source Code</div>{{#ciMaterials}} {{^webhookType}}<div style=/"padding:10px 0/"><table width=/"100%/"><tbody><tr><td style=/"font-size:12px;color:#3b444c;font-weight:600;width:50%/">Branch</td><td style=/"font-size:12px;color:#3b444c;font-weight:600;width:50%/">Commit</td></tr><tr><td style=/"width:50%/">{{appName}}/{{branch}}</td><td style=/"width:50%/"><a href=/"{{& commitLink }}/" target=/"_blank/" style=/"color:#06c/">{{commit}}</a></td></tr></tbody></table></div>{{/webhookType}} {{#webhookType}}{{#webhookData.mergedType}}<div style=/"padding:10px 0/"><table width=/"100%/"><tbody><tr><td style=/"font-size:12px;color:#3b444c;font-weight:600;width:50%/">Title</td><td style=/"font-size:12px;color:#3b444c;font-weight:600;width:50%/">Git URL</td></tr><tr><td style=/"width:50%/">{{webhookData.data.title}}</td><td style=/"width:50%/"><a href=/"{{& webhookData.data.giturl}}/" target=/"_blank/" style=/"color:#06c/">View</a></td></tr></tbody></table></div><div style=/"display:flex;padding:10px 0;grid-template-columns:50% 50%/"><table width=/"100%/"><tbody><tr><td style=/"font-size:12px;color:#3b444c;font-weight:600;width:50%/">Source branch</td><td style=/"font-size:12px;color:#3b444c;font-weight:600;width:50%/">Source Commit</td></tr><tr><td style=/"width:50%/">{{webhookData.data.sourcebranchname}}</td><td style=/"width:50%/"><a href=/"{{& webhookData.data.sourcecheckoutlink}}/" target=/"_blank/" style=/"color:#06c/">{{webhookData.data.sourcecheckout}}</a></td></tr></tbody></table></div><div style=/"display:flex;padding:10px 0;grid-template-columns:50% 50%/"><table width=/"100%/"><tbody><tr><td style=/"font-size:12px;color:#3b444c;font-weight:600;width:50%/">Target Branch</td><td style=/"font-size:12px;color:#3b444c;font-weight:600;width:50%/">Target Commit</td></tr><tr><td style=/"width:50%/">{{webhookData.data.targetbranchname}}</td><td style=/"width:50%/"><a href=/"{{& webhookData.data.sourcecheckoutlink}}/" target=/"_blank/" style=/"color:#06c/">{{webhookData.data.targetcheckout}}</a></td></tr></tbody></table></div>{{/webhookData.mergedType}} {{#webhookData.mergedType}}<div style=/"padding-top:10px/"><div style=/"font-size:12px;color:#3b444c;font-weight:600/">Target Checkout</div><div>{{webhookData.data.targetcheckout}}</div></div>{{/webhookData.mergedType}}</div>{{/webhookType}}{{/ciMaterials}}<div style=/"display:flex;align-items:center;line-height:16px;border-top:1px solid #f2f4f7;padding:20px;align-items:center/"><table><tbody><tr><td><a href=/"https://twitter.com/DevtronL/" target=/"_blank/" style=/"cursor:pointer;text-decoration:none;padding-right:20px/"><svg width=/"24/" height=/"24/" viewBox=/"0 0 24 24/" fill=/"none/" xmlns=/"http://www.w3.org/2000/svg/"><path d=/"M19.9525 8.04571C19.9647 8.22203 19.9647 8.39834 19.9647 8.57628C19.9647 13.9982 15.8371 20.2513 8.28966 20.2513V20.248C6.06013 20.2513 3.8769 19.6126 2 18.4085C2.32419 18.4475 2.65001 18.467 2.97664 18.4678C4.82429 18.4694 6.61913 17.8495 8.07272 16.7079C6.31688 16.6746 4.77717 15.5298 4.23928 13.8584C4.85436 13.9771 5.48812 13.9527 6.09181 13.7877C4.17753 13.401 2.80033 11.7191 2.80033 9.7658V9.7138C3.37071 10.0315 4.00934 10.2078 4.6626 10.2273C2.85964 9.02235 2.30388 6.62382 3.39265 4.74854C5.47593 7.31201 8.54967 8.87041 11.8493 9.03535C11.5186 7.61021 11.9703 6.11681 13.0364 5.11498C14.689 3.56146 17.2882 3.64108 18.8418 5.29292C19.7607 5.11173 20.6415 4.77454 21.4475 4.29678C21.1412 5.24661 20.5001 6.05343 19.6437 6.56613C20.457 6.47025 21.2517 6.2525 22 5.92018C21.4491 6.74569 20.7552 7.46477 19.9525 8.04571Z/" fill=/"#1D9BF0/"/></svg></a></td><td><a href=/"https://www.linkedin.com/company/devtron-labs/mycompany//" target=/"_blank/" style=/"cursor:pointer;text-decoration:none;padding-right:20px/"><svg xmlns=/"http://www.w3.org/2000/svg/" width=/"20/" height=/"20/" viewBox=/"0 0 24 24/"><g fill=/"none/" fill-rule=/"evenodd/"><path d=/"M0 0H24V24H0z/"/><path fill=/"#959BA1/" d=/"M20 2c1.105 0 2 .895 2 2v16c0 1.105-.895 2-2 2H4c-1.105 0-2-.895-2-2V4c0-1.105.895-2 2-2h16zM8.179 9.46H5.177v9.03H8.18V9.46zm7.366-.211l-.225.006c-1.388.075-2.055.845-2.441 1.425l-.039.059V9.461h-3l.002.065c.032 1.033.003 7.625-.002 8.788v.176h3v-5.042l.003-.162c.007-.213.033-.417.096-.57.217-.54.71-1.098 1.54-1.098 1.086 0 1.52.828 1.52 2.041v4.83H19v-5.176l-.004-.256c-.089-2.597-1.538-3.808-3.451-3.808zM6.698 5.108C5.67 5.108 5 5.782 5 6.668c0 .867.651 1.56 1.658 1.56h.02l.162-.006c.951-.068 1.536-.733 1.536-1.554-.02-.886-.652-1.56-1.678-1.56z/"/></g></svg></a></td><td><a href=/"https://devtron.ai/blog//" target=/"_blank/" style=/"color:#000a14;cursor:pointer;text-decoration:none;padding-right:20px/">Blog</a></td><td><a href=/"https://devtron.ai//" target=/"_blank/" style=/"color:#000a14;cursor:pointer;text-decoration:none;padding-right:20px/">Website</a></td><td><a href=/"https://discord.com/invite/jsRG5qx2gp/" target=/"_blank/" style=/"color:#000a14;cursor:pointer;text-decoration:none/">Support</a></td></tr></tbody></table><div style=/"color:#767d84;margin:auto;margin-right:0/">&copy; Devtron Labs 2020</div></div></div></div>"}'
where channel_type = 'ses'
and node_type = 'CI'
and event_type_id = 1;


---- update notification template for CI success ses/smtp
UPDATE notification_templates
set template_payload = '{"from": "{{fromEmail}}",
 "to": "{{toEmail}}",
 "subject": "CI success for app: {{appName}}",
 "html": "<h2 style=\"color:#1dad70;\">Build Pipeline Successful</h2><span>{{eventTime}}</span><br><span>Triggered by <strong>{{triggeredBy}}</strong></span><br><br><a href=\"{{& buildHistoryLink }}\" style=\"height:32px;padding:7px 12px;line-height:32px;font-size:12px;font-weight:600;border-radius:4px;text-decoration:none;outline:none;min-width:64px;text-transform:capitalize;text-align:center;background:#0066cc;color:#fff;border:1px solid transparent;cursor:pointer;\">View Pipeline</a><br><br><hr><br><span>Application: <strong>{{appName}}</strong></span>&nbsp;&nbsp;|&nbsp;&nbsp;<span>Pipeline: <strong>{{pipelineName}}</strong></span><br><br><hr><h3>Source Code</h3>{{#ciMaterials}}{{^webhookType}}<span>Branch: <strong>{{appName}}/{{branch}}</strong></span>&nbsp;&nbsp;|&nbsp;&nbsp;<span>Commit: <a href=\"{{& commitLink }}\"><strong>{{commit}}</strong></a></span><br><br>{{/webhookType}}{{#webhookType}}{{#webhookData.mergedType}}<span>Title: <strong>{{webhookData.data.title}}</strong></span>&nbsp;&nbsp;|&nbsp;&nbsp;<span>Git URL: <a href=\"{{& webhookData.data.giturl}}\"><strong>View</strong></a></span><br><br><span>Source Branch: <strong>{{webhookData.data.sourcebranchname}}</strong></span>&nbsp;&nbsp;|&nbsp;&nbsp;<span>Source Commit: <a href=\"{{& webhookData.data.sourcecheckoutlink}}\"><strong>{{webhookData.data.sourcecheckout}}</strong></a></span><br><br><span>Target Branch: <strong>{{webhookData.data.targetbranchname}}</strong></span>&nbsp;&nbsp;|&nbsp;&nbsp;<span>Target Commit: <a href=\"{{& webhookData.data.targetcheckoutlink}}\"><strong>{{webhookData.data.targetcheckout}}</strong></a></span><br><br>{{/webhookData.mergedType}}{{^webhookData.mergedType}}<span>Target Checkout: <strong>{{webhookData.data.targetcheckout}}</strong></span><br>{{/webhookData.mergedType}}{{/webhookType}}{{/ciMaterials}}<br>"}'
where channel_type = 'ses'
and node_type = 'CI'
and event_type_id = 2;



---- update notification template for CI fail ses/smtp
UPDATE notification_templates
set template_payload = '{"from": "{{fromEmail}}",
 "to": "{{toEmail}}",
 "subject": "CI failed for app: {{appName}}",
 "html": "<h2 style=\"color:#f33e3e;\">Build Pipeline Failed</h2><span>{{eventTime}}</span><br><span>Triggered by <strong>{{triggeredBy}}</strong></span><br><br><a href=\"{{& buildHistoryLink }}\" style=\"height:32px;padding:7px 12px;line-height:32px;font-size:12px;font-weight:600;border-radius:4px;text-decoration:none;outline:none;min-width:64px;text-transform:capitalize;text-align:center;background:#0066cc;color:#fff;border:1px solid transparent;cursor:pointer;\">View Pipeline</a><br><br><hr><br><span>Application: <strong>{{appName}}</strong></span>&nbsp;&nbsp;|&nbsp;&nbsp;<span>Pipeline: <strong>{{pipelineName}}</strong></span><br><br><hr><h3>Source Code</h3>{{#ciMaterials}}{{^webhookType}}<span>Branch: <strong>{{appName}}/{{branch}}</strong></span>&nbsp;&nbsp;|&nbsp;&nbsp;<span>Commit: <a href=\"{{& commitLink }}\"><strong>{{commit}}</strong></a></span><br><br>{{/webhookType}}{{#webhookType}}{{#webhookData.mergedType}}<span>Title: <strong>{{webhookData.data.title}}</strong></span>&nbsp;&nbsp;|&nbsp;&nbsp;<span>Git URL: <a href=\"{{& webhookData.data.giturl}}\"><strong>View</strong></a></span><br><br><span>Source Branch: <strong>{{webhookData.data.sourcebranchname}}</strong></span>&nbsp;&nbsp;|&nbsp;&nbsp;<span>Source Commit: <a href=\"{{& webhookData.data.sourcecheckoutlink}}\"><strong>{{webhookData.data.sourcecheckout}}</strong></a></span><br><br><span>Target Branch: <strong>{{webhookData.data.targetbranchname}}</strong></span>&nbsp;&nbsp;|&nbsp;&nbsp;<span>Target Commit: <a href=\"{{& webhookData.data.targetcheckoutlink}}\"><strong>{{webhookData.data.targetcheckout}}</strong></a></span><br><br>{{/webhookData.mergedType}}{{^webhookData.mergedType}}<span>Target Checkout: <strong>{{webhookData.data.targetcheckout}}</strong></span><br>{{/webhookData.mergedType}}{{/webhookType}}{{/ciMaterials}}<br>"}'
where channel_type = 'ses'
and node_type = 'CI'
and event_type_id = 3;


---- update notification template for CD trigger ses/smtp
UPDATE notification_templates
set template_payload = '{"from": "{{fromEmail}}",
 "to": "{{toEmail}}",
 "subject": "CD triggered for app: {{appName}} on environment: {{envName}}",
 "html": "<h2 style=\"color:#767d84;\">{{stage}} Pipeline Triggered</h2><span>{{eventTime}}</span><br><span>Triggered by <strong>{{triggeredBy}}</strong></span><br><br>{{#deploymentHistoryLink}}<a href=\"{{& deploymentHistoryLink}}\" style=\"height:32px;padding:7px 12px;line-height:32px;font-size:12px;font-weight:600;border-radius:4px;text-decoration:none;outline:none;min-width:64px;text-transform:capitalize;text-align:center;background:#0066cc;color:#fff;border:1px solid transparent;cursor:pointer;\">View Pipeline</a>{{/deploymentHistoryLink}}&nbsp;&nbsp;&nbsp;{{#appDetailsLink}}<a href=\"{{& appDetailsLink}}\" style=\"height:32px;padding:7px 12px;line-height:32px;font-size:12px;font-weight:600;border-radius:4px;text-decoration:none;outline:none;min-width:64px;text-transform:capitalize;text-align:center;background:#fff;color:#3b444c;border:1px solid #d0d4d9;cursor:pointer;\">App Details</a><br><br>{{/appDetailsLink}}<hr><br><span>Application: <strong>{{appName}}</strong></span>&nbsp;&nbsp;|&nbsp;&nbsp;<span>Pipeline: <strong>{{pipelineName}}</strong></span><br><br><span>Environment: <strong>{{envName}}</strong></span>&nbsp;&nbsp;|&nbsp;&nbsp;<span>Stage: <strong>{{stage}}</strong></span><br><br><hr><h3>Source Code</h3>{{#ciMaterials}}{{^webhookType}}<span>Branch: <strong>{{appName}}/{{branch}}</strong></span>&nbsp;&nbsp;|&nbsp;&nbsp;<span>Commit: <a href=\"{{& commitLink}}\"><strong>{{commit}}</strong></a></span><br>{{/webhookType}}{{#webhookType}}{{#webhookData.mergedType}}<span>Title: <strong>{{webhookData.data.title}}</strong></span>&nbsp;&nbsp;|&nbsp;&nbsp;<span>Git URL: <a href=\"{{& webhookData.data.giturl}}\"><strong>View</strong></a></span><br><span>Source Branch: <strong>{{webhookData.data.sourcebranchname}}</strong></span>&nbsp;&nbsp;|&nbsp;&nbsp;<span>Source Commit: <a href=\"{{& webhookData.data.sourcecheckoutlink}}\"><strong>{{webhookData.data.sourcecheckout}}</strong></a></span><br><span>Target Branch: <strong>{{webhookData.data.targetbranchname}}</strong></span>&nbsp;&nbsp;|&nbsp;&nbsp;<span>Target Commit: <a href=\"{{& webhookData.data.targetcheckoutlink}}\"><strong>{{webhookData.data.targetcheckout}}</strong></a></span><br>{{/webhookData.mergedType}}{{^webhookData.mergedType}}<span>Target Checkout: <strong>{{webhookData.data.targetcheckout}}</strong></span><br>{{/webhookData.mergedType}}{{/webhookType}}{{/ciMaterials}}<br><br><hr><h3>Image</h3><span>Docker Image: <strong>{{dockerImg}}</strong></span><br>"}'
where channel_type = 'ses'
and node_type = 'CD'
and event_type_id = 1;



---- update notification template for CD success ses/smtp
UPDATE notification_templates
set template_payload = '{"from": "{{fromEmail}}",
 "to": "{{toEmail}}",
 "subject": "CD success for app: {{appName}} on environment: {{envName}}",
 "html": "<h2 style=\"color:#1dad70;\">{{stage}} Pipeline Successful</h2><span>{{eventTime}}</span><br><span>Triggered by <strong>{{triggeredBy}}</strong></span><br><br>{{#deploymentHistoryLink}}<a href=\"{{& deploymentHistoryLink}}\" style=\"height:32px;padding:7px 12px;line-height:32px;font-size:12px;font-weight:600;border-radius:4px;text-decoration:none;outline:none;min-width:64px;text-transform:capitalize;text-align:center;background:#0066cc;color:#fff;border:1px solid transparent;cursor:pointer;\">View Pipeline</a>{{/deploymentHistoryLink}}&nbsp;&nbsp;&nbsp;{{#appDetailsLink}}<a href=\"{{& appDetailsLink}}\" style=\"height:32px;padding:7px 12px;line-height:32px;font-size:12px;font-weight:600;border-radius:4px;text-decoration:none;outline:none;min-width:64px;text-transform:capitalize;text-align:center;background:#fff;color:#3b444c;border:1px solid #d0d4d9;cursor:pointer;\">App Details</a><br><br>{{/appDetailsLink}}<hr><br><span>Application: <strong>{{appName}}</strong></span>&nbsp;&nbsp;|&nbsp;&nbsp;<span>Pipeline: <strong>{{pipelineName}}</strong></span><br><br><span>Environment: <strong>{{envName}}</strong></span>&nbsp;&nbsp;|&nbsp;&nbsp;<span>Stage: <strong>{{stage}}</strong></span><br><br><hr><h3>Source Code</h3>{{#ciMaterials}}{{^webhookType}}<span>Branch: <strong>{{appName}}/{{branch}}</strong></span>&nbsp;&nbsp;|&nbsp;&nbsp;<span>Commit: <a href=\"{{& commitLink}}\"><strong>{{commit}}</strong></a></span><br>{{/webhookType}}{{#webhookType}}{{#webhookData.mergedType}}<span>Title: <strong>{{webhookData.data.title}}</strong></span>&nbsp;&nbsp;|&nbsp;&nbsp;<span>Git URL: <a href=\"{{& webhookData.data.giturl}}\"><strong>View</strong></a></span><br><span>Source Branch: <strong>{{webhookData.data.sourcebranchname}}</strong></span>&nbsp;&nbsp;|&nbsp;&nbsp;<span>Source Commit: <a href=\"{{& webhookData.data.sourcecheckoutlink}}\"><strong>{{webhookData.data.sourcecheckout}}</strong></a></span><br><span>Target Branch: <strong>{{webhookData.data.targetbranchname}}</strong></span>&nbsp;&nbsp;|&nbsp;&nbsp;<span>Target Commit: <a href=\"{{& webhookData.data.targetcheckoutlink}}\"><strong>{{webhookData.data.targetcheckout}}</strong></a></span><br>{{/webhookData.mergedType}}{{^webhookData.mergedType}}<span>Target Checkout: <strong>{{webhookData.data.targetcheckout}}</strong></span><br>{{/webhookData.mergedType}}{{/webhookType}}{{/ciMaterials}}<br><br><hr><h3>Image</h3><span>Docker Image: <strong>{{dockerImg}}</strong></span><br>"}'
where channel_type = 'ses'
and node_type = 'CD'
and event_type_id = 2;


---- update notification template for CD fail ses/smtp
UPDATE notification_templates
set template_payload = '{"from": "{{fromEmail}}",
 "to": "{{toEmail}}",
 "subject": "CD failed for app: {{appName}} on environment: {{envName}}",
 "html": "<h2 style=\"color:#f33e3e;\">{{stage}} Pipeline Failed</h2><span>{{eventTime}}</span><br><span>Triggered by <strong>{{triggeredBy}}</strong></span><br><br>{{#deploymentHistoryLink}}<a href=\"{{& deploymentHistoryLink}}\" style=\"height:32px;padding:7px 12px;line-height:32px;font-size:12px;font-weight:600;border-radius:4px;text-decoration:none;outline:none;min-width:64px;text-transform:capitalize;text-align:center;background:#0066cc;color:#fff;border:1px solid transparent;cursor:pointer;\">View Pipeline</a>{{/deploymentHistoryLink}}&nbsp;&nbsp;&nbsp;{{#appDetailsLink}}<a href=\"{{& appDetailsLink}}\" style=\"height:32px;padding:7px 12px;line-height:32px;font-size:12px;font-weight:600;border-radius:4px;text-decoration:none;outline:none;min-width:64px;text-transform:capitalize;text-align:center;background:#fff;color:#3b444c;border:1px solid #d0d4d9;cursor:pointer;\">App Details</a><br><br>{{/appDetailsLink}}<hr><br><span>Application: <strong>{{appName}}</strong></span>&nbsp;&nbsp;|&nbsp;&nbsp;<span>Pipeline: <strong>{{pipelineName}}</strong></span><br><br><span>Environment: <strong>{{envName}}</strong></span>&nbsp;&nbsp;|&nbsp;&nbsp;<span>Stage: <strong>{{stage}}</strong></span><br><br><hr><h3>Source Code</h3>{{#ciMaterials}}{{^webhookType}}<span>Branch: <strong>{{appName}}/{{branch}}</strong></span>&nbsp;&nbsp;|&nbsp;&nbsp;<span>Commit: <a href=\"{{& commitLink}}\"><strong>{{commit}}</strong></a></span><br>{{/webhookType}}{{#webhookType}}{{#webhookData.mergedType}}<span>Title: <strong>{{webhookData.data.title}}</strong></span>&nbsp;&nbsp;|&nbsp;&nbsp;<span>Git URL: <a href=\"{{& webhookData.data.giturl}}\"><strong>View</strong></a></span><br><span>Source Branch: <strong>{{webhookData.data.sourcebranchname}}</strong></span>&nbsp;&nbsp;|&nbsp;&nbsp;<span>Source Commit: <a href=\"{{& webhookData.data.sourcecheckoutlink}}\"><strong>{{webhookData.data.sourcecheckout}}</strong></a></span><br><span>Target Branch: <strong>{{webhookData.data.targetbranchname}}</strong></span>&nbsp;&nbsp;|&nbsp;&nbsp;<span>Target Commit: <a href=\"{{& webhookData.data.targetcheckoutlink}}\"><strong>{{webhookData.data.targetcheckout}}</strong></a></span><br>{{/webhookData.mergedType}}{{^webhookData.mergedType}}<span>Target Checkout: <strong>{{webhookData.data.targetcheckout}}</strong></span><br>{{/webhookData.mergedType}}{{/webhookType}}{{/ciMaterials}}<br><br><hr><h3>Image</h3><span>Docker Image: <strong>{{dockerImg}}</strong></span><br>"}'
where channel_type = 'ses'
and node_type = 'CD'
and event_type_id = 3;